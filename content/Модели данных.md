Данный документ предназначен для описания сущностей данных, которые используются в системе.
Включает в себя описание моделей для баз данных и api запросов.
# Реляционная база данных
## Grant
Сущность описывающая грант. Поля формируются в трех компонентах:
Парсер - первичная обработка;
ML - анализ;
Backend - служебная информация.

| **Поле**          | **Тип (БД)**  | **Null** | **Описание**                                                            | **Формируется где**                    |
| ----------------- | ------------- | -------- | ----------------------------------------------------------------------- | -------------------------------------- |
| **id**            | serial        | NO       | Уникальный идентификатор записи                                         | Backend (при вставке в БД)             |
| **source_name**   | varchar(255)  | NO       | Название источника (сайт, агрегатор и т.д.)                             | Парсер                                 |
| **url**           | text          | NO       | Ссылка на оригинал публикации                                           | Парсер                                 |
| **published_at**  | date          | NO       | Дата публикации источника                                               | Парсер                                 |
| **title**         | text          | NO       | Заголовок гранта                                                        | Парсер                                 |
| **text_raw**      | text          | NO       | Полный текст публикации (сырой, неочищенный)                            | Парсер                                 |
| **text_clean**    | text          | NO       | Очищенный текст публикации (удалены html, лишние символы и т.п.)        | Парсер                                 |
| **summary**       | text          | NO       | Краткое описание, сгенерированное автоматически                         | Парсер                                 |
| **amount_text**   | varchar(255)  | YES      | Размер финансирования в текстовом виде                                  | Парсер                                 |
| **amount_value**  | numeric(15,2) | YES      | Размер финансирования в числовом виде                                   | Парсер (извлекает число из amountText) |
| **deadline_text** | varchar(255)  | YES      | Крайний срок подачи заявок (в текстовом виде)                           | Парсер                                 |
| **deadline_date** | date          | YES      | Крайний срок подачи заявок (в формате даты)                             | Парсер (конвертация из deadlineText)   |
| **layer**         | varchar(255)  | NO       | Текущий слой (active_layer, archive_layer, template_layer)              | Backend                                |
| **apply_link**    | text          | YES      | Ссылка на форму подачи заявки                                           | Парсер                                 |
| **tags**          | text[]        | YES      | Массив тегов, выделенных из текста                                      | Парсер                                 |
| **contact_email** | varchar(255)  | YES      | Почта для связи                                                         | Парсер                                 |
| **contact_phone** | varchar(64)   | YES      | Телефон для связи                                                       | Парсер                                 |
| **requirements**  | text          | YES      | Требования к участникам (возраст, статус, резидентство и т.п.)          | Парсер                                 |
| **organization**  | varchar(255)  | YES      | Организатор гранта                                                      | Парсер                                 |
| **extra_data**    | jsonb         | YES      | Неструктурированные дополнительные данные (всё, что не в основные поля) | Парсер или ML или Backend              |
| **created_at**    | timestamp     | NO       | Время добавления записи в БД                                            | Backend                                |



## User
Сущность описывающая пользователя зарегистрированного в системе.

| Поле                  | Тип (БД)          | Null             | Описание                              |
| --------------------- | ----------------- | ---------------- | ------------------------------------- |
| id                    | serial            | NO               | Уникальный идентификатор пользователя |
| tg_id                 | bigint            | YES              | Telegram ID, если есть                |
| first_name            | String            | YES              | Имя пользователя в Telegram.          |
| last_name             | String (Optional) | YES              | Фамилия пользователя в Telegram.      |
| username              | varchar(255)      | NO               | Юзернейм                              |
| region                | varchar(255)      | YES              | Регион пользователя                   |
| profile_text          | text              | YES              | Описание проекта                      |
| photo_url             | text              | YES              | ссылка на фото профиля                |
| notifications_enabled | boolean           | NO, default true | Получает ли уведомления               |
| created_at            | timestamp         | NO               | Когда создан профиль                  |
# API
### Parser
#### to backend
### Web
#### to backend. Регистрация через web 
**Request**:

| Поле       | Тип               | Null | Описание                                                                                                                  |
| ---------- | ----------------- | ---- | ------------------------------------------------------------------------------------------------------------------------- |
| tg_id      | Integer           | Да   | Уникальный ID пользователя в Telegram. Используется как основной ключ.                                                    |
| first_name | String            | Да   | Имя пользователя в Telegram.                                                                                              |
| last_name  | String (Optional) | Нет  | Фамилия пользователя в Telegram.                                                                                          |
| username   | String (Optional) | Нет  | Юзернейм пользователя в Telegram.                                                                                         |
| photo_url  | String (Optional) | Нет  | Ссылка на аватар пользователя.                                                                                            |
| auth_date  | Integer           | Да   | UNIX-таймстамп, когда произошла авторизация. Используется для проверки подлинности запроса.                               |
| hash       | String            | Да   | Криптографическая хеш-сумма для проверки целостности и подлинности данных. Используется для проверки подлинности запроса. |
**Response**:

| Поле         | Тип     | Описание                               |
| ------------ | ------- | -------------------------------------- |
| access_token | String  | JWT (JSON Web Token).                  |
| token_type   | String  | Тип токена, обычно "Bearer".           |
| expires_in   | Integer | Срок действия access_token в секундах. |
#### to backend. Обновление токена

**Request**: HTTP-Only Cookie
**Response**:

| Поле         | Тип     | Описание                               |
| ------------ | ------- | -------------------------------------- |
| access_token | String  | JWT (JSON Web Token).                  |
| token_type   | String  | Тип токена, обычно "Bearer".           |
| expires_in   | Integer | Срок действия access_token в секундах. |
#### to backend. Регистрация через tg


**request:**

| Поле       | Тип               | Null | Описание                                                                                                                  |
| ---------- | ----------------- | ---- | ------------------------------------------------------------------------------------------------------------------------- |
| tg_id      | Integer           | Да   | Уникальный ID пользователя в Telegram. Используется как основной ключ.                                                    |
| first_name | String            | Да   | Имя пользователя в Telegram.                                                                                              |
| last_name  | String (Optional) | Нет  | Фамилия пользователя в Telegram.                                                                                          |
| username   | String (Optional) | Нет  | Юзернейм пользователя в Telegram.                                                                                         |
| photo_url  | String (Optional) | Нет  | Ссылка на аватар пользователя.                                                                                            |

**response:**
будет достаточно кода состояния.
